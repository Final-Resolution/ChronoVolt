C51 COMPILER V9.59.0.0   UART                                                              05/04/2019 03:50:48 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN ..\output\uart.obj
COMPILER INVOKED BY: C:\soft\Keil_v5\C51\BIN\C51.EXE ..\source\uart.c OPTIMIZE(8,SPEED) BROWSE DEFINE(FOSC_160000) DEBUG
                    - OBJECTEXTEND PRINT(.\Listings\uart.lst) TABS(2) OBJECT(..\output\uart.obj)

line level    source

   1          /**
   2           * @file uart.c
   3           * @author mangolu (mangolu81@gmail.com)
   4           * @brief N76E003串口相关操作实现
   5           * @version 1.0.0
   6           * @date 2019-05-04
   7           *
   8           * @copyright Copyright (c) 2019 mangolu All righits reserved
   9           *
  10           */
  11          /** 所需头文件开始>>> */
  12          
  13          #include "uart.h"
  14          #include "gpio.h"
  15          
  16          /** 所需头文件结束<<< */
  17          
  18          
  19          #define BUFFER_SIZE   16
  20          unsigned char  UART_BUFFER[BUFFER_SIZE],temp;
  21          unsigned int u16CNT=0,u16CNT1=0;
  22          bit riflag;
  23          
  24          void InitialUART1_Timer3(unsigned long u32Baudrate) { //use timer3 as Baudrate generator
  25   1        SET_P02_Quasi_Mode;   //Setting UART pin as Quasi mode for transmit
  26   1        SET_P16_Quasi_Mode;   //Setting UART pin as Quasi mode for transmit
  27   1      
  28   1        SCON_1 = 0x50;    //UART1 Mode1,REN_1=1,TI_1=1
  29   1        T3CON = 0x08;     //T3PS2=0,T3PS1=0,T3PS0=0(Prescale=1), UART1 in MODE 1
  30   1        clr_BRCK;
  31   1      
  32   1      #ifdef FOSC_160000
  33   1        RH3    = HIBYTE(65536 - (1000000 / u32Baudrate) - 1);     /*16 MHz */
  34   1        RL3    = LOBYTE(65536 - (1000000 / u32Baudrate) - 1);     /*16 MHz */
  35   1      #endif
  36   1      #ifdef FOSC_166000
                RH3    = HIBYTE(65536 - (1037500 / u32Baudrate));       /*16.6 MHz */
                RL3    = LOBYTE(65536 - (1037500 / u32Baudrate));       /*16.6 MHz */
              #endif
  40   1        set_TR3;         //Trigger Timer3
  41   1      }
  42          
  43          unsigned char Receive_Data_From_UART1(void) {
  44   1        unsigned char c;
  45   1      
  46   1        while (!RI_1);
  47   1      
  48   1        c = SBUF_1;
  49   1        RI_1 = 0;
  50   1        return (c);
  51   1      }
  52          
  53          void Send_Data_To_UART1 (unsigned char c) {
  54   1        TI_1 = 0;
C51 COMPILER V9.59.0.0   UART                                                              05/04/2019 03:50:48 PAGE 2   

  55   1        SBUF_1 = c;
  56   1      
  57   1        while(TI_1 == 0);
  58   1      }
  59          
  60          void SerialPort1_ISR(void) interrupt 15 
  61          {
  62   1          if (RI_1==1) 
  63   1          {                                       /* if reception occur */
  64   2              clr_RI_1;                             /* clear reception flag for next reception */
  65   2              UART_BUFFER[u16CNT] = SBUF_1;
  66   2              u16CNT ++;
  67   2              riflag =1;
  68   2          }
  69   1          if(TI_1==1)
  70   1          {
  71   2              clr_TI_1;                             /* if emission occur */
  72   2          }
  73   1      }
  74          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    159    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     21       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
